-- Test the built-in gp_dump_query function.
SELECT gp_dump_query_oids('SELECT 123');
INFO:  GPORCA failed to produce a plan, falling back to planner
      gp_dump_query_oids       
-------------------------------
 {"relids": "", "funcids": ""}
(1 row)

SELECT gp_dump_query_oids('SELECT * FROM pg_proc');
INFO:  GPORCA failed to produce a plan, falling back to planner
        gp_dump_query_oids         
-----------------------------------
 {"relids": "1255", "funcids": ""}
(1 row)

SELECT gp_dump_query_oids('SELECT length(proname) FROM pg_proc');
INFO:  GPORCA failed to produce a plan, falling back to planner
            gp_dump_query_oids             
-------------------------------------------
 {"relids": "1255", "funcids": "1317,406"}
(1 row)

-- with EXPLAIN
SELECT gp_dump_query_oids('explain SELECT length(proname) FROM pg_proc');
INFO:  GPORCA failed to produce a plan, falling back to planner
            gp_dump_query_oids             
-------------------------------------------
 {"relids": "1255", "funcids": "1317,406"}
(1 row)

-- with a multi-query statement
SELECT gp_dump_query_oids('SELECT length(proname) FROM pg_proc; SELECT abs(relpages) FROM pg_class');
INFO:  GPORCA failed to produce a plan, falling back to planner
                 gp_dump_query_oids                  
-----------------------------------------------------
 {"relids": "1255,1259", "funcids": "1317,406,1397"}
(1 row)

-- Test error reporting on an invalid query.
SELECT gp_dump_query_oids('SELECT * FROM nonexistent_table');
INFO:  GPORCA failed to produce a plan, falling back to planner
ERROR:  relation "nonexistent_table" does not exist
LINE 1: SELECT * FROM nonexistent_table
                      ^
QUERY:  SELECT * FROM nonexistent_table
SELECT gp_dump_query_oids('SELECT with syntax error');
INFO:  GPORCA failed to produce a plan, falling back to planner
ERROR:  syntax error at or near "with syntax"
LINE 1: SELECT with syntax error
               ^
QUERY:  SELECT with syntax error
