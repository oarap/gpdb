drop table if exists vfheap;
NOTICE:  table "vfheap" does not exist, skipping
create table vfheap (a, b, c) as
select 1, i, repeat('x', 1000) from generate_series(1, 100)i distributed by (a);
create index ivfheap on vfheap(b, c);
-- delete half of table
delete from vfheap where b between 0 and (select count(*) / 2 from vfheap);
INFO:  GPORCA failed to produce a plan, falling back to planner
select pg_relation_size('vfheap') from gp_dist_random('gp_id') where gp_segment_id = 0;
INFO:  GPORCA failed to produce a plan, falling back to planner
 pg_relation_size 
------------------
           131072
(1 row)

select pg_relation_size('ivfheap') from gp_dist_random('gp_id') where gp_segment_id = 0;
INFO:  GPORCA failed to produce a plan, falling back to planner
 pg_relation_size 
------------------
           196608
(1 row)

-- show pages are truncated
vacuum full freeze vfheap;
select pg_relation_size('vfheap') from gp_dist_random('gp_id') where gp_segment_id = 0;
INFO:  GPORCA failed to produce a plan, falling back to planner
 pg_relation_size 
------------------
            65536
(1 row)

select pg_relation_size('ivfheap') from gp_dist_random('gp_id') where gp_segment_id = 0;
INFO:  GPORCA failed to produce a plan, falling back to planner
 pg_relation_size 
------------------
           262144
(1 row)

select max(b), min(substring(c, 10, 1)) from vfheap;
 max | min 
-----+-----
 100 | x
(1 row)

